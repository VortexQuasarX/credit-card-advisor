// Internal Google AI API key (lightly obfuscated and not rendered in UI)
const GOOGLE_AI_API_KEY = (function () {
    const parts = [
        "AIzaSyA18oYBubRaohzMLKI4EeN3Z7FZ2H_-",
        "B-o"
    ];
    return parts.join("");
})();
const GEMINI_MODEL_ID = 'gemini-1.5-flash';
function isLikelyValidGoogleKey(k) { return /^AIza[0-9A-Za-z-_]{30,}$/.test(k || ''); }

// --- GLOBAL CARD DATABASE (HARDCODED & REBALANCED) ---
const GlobalCardAPI = {
    async fetchAllCards() {
        console.log("Loading hardcoded card database...");
        // This is now a static list, not a real API call.
        return [
            // India (10) - Added Secured Cards & REBALANCED PerksValue
            { "CardName": "ICICI Bank Instant Platinum (Secured)", "Issuer": "ICICI", "CardTier": "Entry-Level", "Currency": "INR", "Country": "IN", "MinIncome": 0, "MinCreditScore": 300, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.04, "RewardCategories": ["Rewards"], "reward_rates": [{ "category": "default", "rate": 0.0075 }], "PerksValue": 0 },
            { "CardName": "SBI Card Unnati (Secured)", "Issuer": "SBI", "CardTier": "Entry-Level", "Currency": "INR", "Country": "IN", "MinIncome": 0, "MinCreditScore": 300, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.04, "RewardCategories": ["Cashback"], "reward_rates": [{ "category": "default", "rate": 0.01 }], "PerksValue": 0 },
            { "CardName": "ICICI Amazon Pay", "Issuer": "ICICI", "CardTier": "Standard", "Currency": "INR", "Country": "IN", "MinIncome": 300000, "MinCreditScore": 650, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.06, "RewardCategories": ["Online Shopping", "Cashback"], "reward_rates": [{ "category": "amazon_prime", "rate": 0.05 }, { "category": "utilities", "rate": 0.02 }, { "category": "default", "rate": 0.01 }] },
            { "CardName": "Axis Flipkart", "Issuer": "Axis", "CardTier": "Standard", "Currency": "INR", "Country": "IN", "MinIncome": 300000, "MinCreditScore": 650, "AnnualFee": 500, "LoungeAccess": false, "ProfitMargin": 0.07, "RewardCategories": ["Online Shopping", "Cashback", "Travel"], "reward_rates": [{ "category": "flipkart_myntra", "rate": 0.05 }, { "category": "travel", "rate": 0.015 }, { "category": "default", "rate": 0.015 }] },
            { "CardName": "HDFC Millennia", "Issuer": "HDFC", "CardTier": "Standard", "Currency": "INR", "Country": "IN", "MinIncome": 350000, "MinCreditScore": 700, "AnnualFee": 1000, "LoungeAccess": true, "ProfitMargin": 0.08, "RewardCategories": ["Online Shopping", "Cashback", "Dining"], "reward_rates": [{ "category": "online_shopping", "rate": 0.05 }, { "category": "dining", "rate": 0.01 }, { "category": "default", "rate": 0.01 }], "PerksValue": 1000 },
            { "CardName": "SBI Card ELITE", "Issuer": "SBI", "CardTier": "Premium", "Currency": "INR", "Country": "IN", "MinIncome": 1000000, "MinCreditScore": 750, "AnnualFee": 4999, "LoungeAccess": true, "ProfitMargin": 0.11, "RewardCategories": ["Travel", "Rewards", "Lifestyle", "Dining"], "reward_rates": [{ "category": "dining", "rate": 0.05 }, { "category": "groceries", "rate": 0.05 }, { "category": "travel", "rate": 0.02 }, { "category": "default", "rate": 0.01 }], "PerksValue": 4000 }, // REBALANCED
            { "CardName": "Axis Magnus", "Issuer": "Axis", "CardTier": "Super-Premium", "Currency": "INR", "Country": "IN", "MinIncome": 1800000, "MinCreditScore": 800, "AnnualFee": 12500, "LoungeAccess": true, "ProfitMargin": 0.13, "RewardCategories": ["Travel", "Lifestyle", "Rewards"], "reward_rates": [{ "category": "travel", "rate": 0.06 }, { "category": "default", "rate": 0.024 }], "PerksValue": 12000 }, // REBALANCED
            { "CardName": "IDFC First Wealth", "Issuer": "IDFC", "CardTier": "Premium", "Currency": "INR", "Country": "IN", "MinIncome": 1200000, "MinCreditScore": 750, "AnnualFee": 0, "LoungeAccess": true, "ProfitMargin": 0.1, "RewardCategories": ["Rewards", "Travel"], "reward_rates": [{ "category": "online_shopping", "rate": 0.025 }, { "category": "default", "rate": 0.0075 }], "PerksValue": 2000 },
            { "CardName": "Tata Neu Infinity HDFC", "Issuer": "HDFC", "CardTier": "Premium", "Currency": "INR", "Country": "IN", "MinIncome": 1200000, "MinCreditScore": 750, "AnnualFee": 1499, "LoungeAccess": true, "ProfitMargin": 0.09, "RewardCategories": ["Rewards", "Cashback"], "reward_rates": [{ "category": "online_shopping", "rate": 0.05 }, { "category": "utilities", "rate": 0.05 }, { "category": "default", "rate": 0.015 }], "PerksValue": 1500 },
            { "CardName": "Standard Chartered Ultimate", "Issuer": "Standard Chartered", "CardTier": "Premium", "Currency": "INR", "Country": "IN", "MinIncome": 2400000, "MinCreditScore": 780, "AnnualFee": 5000, "LoungeAccess": true, "ProfitMargin": 0.12, "RewardCategories": ["Rewards", "Travel"], "reward_rates": [{ "category": "default", "rate": 0.033 }], "PerksValue": 5000 },

            // USA (17) - Added Secured Cards
            { "CardName": "Discover it Secured Card", "Issuer": "Discover", "CardTier": "Entry-Level", "Currency": "USD", "Country": "US", "MinIncome": 0, "MinCreditScore": 300, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.05, "RewardCategories": ["Cashback", "Rotating Categories"], "reward_rates": [{ "category": "dining", "rate": 0.02 }, { "category": "fuel", "rate": 0.02 }, { "category": "default", "rate": 0.01 }], "PerksValue": 0 },
            { "CardName": "Capital One Quicksilver Secured", "Issuer": "Capital One", "CardTier": "Entry-Level", "Currency": "USD", "Country": "US", "MinIncome": 0, "MinCreditScore": 300, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.05, "RewardCategories": ["Cashback"], "reward_rates": [{ "category": "default", "rate": 0.015 }], "PerksValue": 0 },
            { "CardName": "Chase Sapphire Preferred", "Issuer": "Chase", "CardTier": "Premium", "Currency": "USD", "Country": "US", "MinIncome": 50000, "MinCreditScore": 720, "AnnualFee": 95, "LoungeAccess": false, "ProfitMargin": 0.15, "RewardCategories": ["Travel", "Dining"], "reward_rates": [{ "category": "travel", "rate": 0.05 }, { "category": "dining", "rate": 0.03 }, { "category": "online_shopping", "rate": 0.03 }, { "category": "default", "rate": 0.01 }], "PerksValue": 100 },
            { "CardName": "Amex Gold Card", "Issuer": "American Express", "CardTier": "Super-Premium", "Currency": "USD", "Country": "US", "MinIncome": 60000, "MinCreditScore": 700, "AnnualFee": 250, "LoungeAccess": false, "ProfitMargin": 0.18, "RewardCategories": ["Dining", "Groceries", "Travel"], "reward_rates": [{ "category": "dining", "rate": 0.04 }, { "category": "groceries", "rate": 0.04 }, { "category": "travel", "rate": 0.03 }, { "category": "default", "rate": 0.01 }], "PerksValue": 120 },
            { "CardName": "Capital One Venture X", "Issuer": "Capital One", "CardTier": "Super-Premium", "Currency": "USD", "Country": "US", "MinIncome": 75000, "MinCreditScore": 750, "AnnualFee": 395, "LoungeAccess": true, "ProfitMargin": 0.20, "RewardCategories": ["Travel", "Lifestyle"], "reward_rates": [{ "category": "travel", "rate": 0.10 }, { "category": "default", "rate": 0.02 }], "PerksValue": 300 },
            { "CardName": "Amex Platinum", "Issuer": "American Express", "CardTier": "Super-Premium", "Currency": "USD", "Country": "US", "MinIncome": 100000, "MinCreditScore": 750, "AnnualFee": 695, "LoungeAccess": true, "ProfitMargin": 0.25, "RewardCategories": ["Travel", "Luxury", "Lifestyle"], "reward_rates": [{ "category": "travel", "rate": 0.05 }, { "category": "default", "rate": 0.01 }], "PerksValue": 600 },
            { "CardName": "Citi Double Cash", "Issuer": "Citi", "CardTier": "Standard", "Currency": "USD", "Country": "US", "MinIncome": 30000, "MinCreditScore": 690, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.12, "RewardCategories": ["Cashback"], "reward_rates": [{ "category": "default", "rate": 0.02 }], "PerksValue": 0 },
            { "CardName": "Chase Freedom Flex", "Issuer": "Chase", "CardTier": "Standard", "Currency": "USD", "Country": "US", "MinIncome": 25000, "MinCreditScore": 690, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.11, "RewardCategories": ["Cashback", "Rotating Categories"], "reward_rates": [{ "category": "travel", "rate": 0.05 }, { "category": "dining", "rate": 0.03 }, { "category": "default", "rate": 0.01 }], "PerksValue": 0 },
            { "CardName": "Discover it Cash Back", "Issuer": "Discover", "CardTier": "Standard", "Currency": "USD", "Country": "US", "MinIncome": 20000, "MinCreditScore": 670, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.10, "RewardCategories": ["Cashback", "Rotating Categories"], "reward_rates": [{ "category": "groceries", "rate": 0.05 }, { "category": "online_shopping", "rate": 0.05 }, { "category": "default", "rate": 0.01 }], "PerksValue": 0 },
            { "CardName": "Blue Cash Preferred", "Issuer": "American Express", "CardTier": "Premium", "Currency": "USD", "Country": "US", "MinIncome": 40000, "MinCreditScore": 690, "AnnualFee": 95, "LoungeAccess": false, "ProfitMargin": 0.14, "RewardCategories": ["Groceries", "Cashback", "Fuel"], "reward_rates": [{ "category": "groceries", "rate": 0.06 }, { "category": "fuel", "rate": 0.03 }, { "category": "default", "rate": 0.01 }], "PerksValue": 0 },
            { "CardName": "Chase Sapphire Reserve", "Issuer": "Chase", "CardTier": "Super-Premium", "Currency": "USD", "Country": "US", "MinIncome": 90000, "MinCreditScore": 760, "AnnualFee": 550, "LoungeAccess": true, "ProfitMargin": 0.22, "RewardCategories": ["Travel", "Dining", "Luxury"], "reward_rates": [{ "category": "travel", "rate": 0.1 }, { "category": "dining", "rate": 0.03 }, { "category": "default", "rate": 0.01 }], "PerksValue": 300 },
            { "CardName": "Bilt Mastercard", "Issuer": "Bilt", "CardTier": "Standard", "Currency": "USD", "Country": "US", "MinIncome": 35000, "MinCreditScore": 680, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.13, "RewardCategories": ["Travel", "Dining", "Rent"], "reward_rates": [{ "category": "dining", "rate": 0.03 }, { "category": "travel", "rate": 0.02 }, { "category": "default", "rate": 0.01 }], "PerksValue": 0 },
            { "CardName": "Wells Fargo Active Cash", "Issuer": "Wells Fargo", "CardTier": "Standard", "Currency": "USD", "Country": "US", "MinIncome": 25000, "MinCreditScore": 680, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.12, "RewardCategories": ["Cashback"], "reward_rates": [{ "category": "default", "rate": 0.02 }], "PerksValue": 0 },
            { "CardName": "Marriott Bonvoy Brilliant", "Issuer": "American Express", "CardTier": "Super-Premium", "Currency": "USD", "Country": "US", "MinIncome": 80000, "MinCreditScore": 740, "AnnualFee": 650, "LoungeAccess": true, "ProfitMargin": 0.23, "RewardCategories": ["Travel", "Hotels"], "reward_rates": [{ "category": "travel", "rate": 0.06 }, { "category": "dining", "rate": 0.03 }, { "category": "default", "rate": 0.02 }], "PerksValue": 400 },
            { "CardName": "Delta SkyMiles Gold", "Issuer": "American Express", "CardTier": "Premium", "Currency": "USD", "Country": "US", "MinIncome": 40000, "MinCreditScore": 690, "AnnualFee": 99, "LoungeAccess": false, "ProfitMargin": 0.15, "RewardCategories": ["Travel", "Airlines"], "reward_rates": [{ "category": "travel", "rate": 0.02 }, { "category": "dining", "rate": 0.02 }, { "category": "default", "rate": 0.01 }], "PerksValue": 100 },
            { "CardName": "Amex Centurion (Black Card)", "Issuer": "American Express", "CardTier": "Super-Premium", "Currency": "USD", "Country": "US", "MinIncome": 2000000, "MinCreditScore": 800, "AnnualFee": 5000, "LoungeAccess": true, "ProfitMargin": 0.35, "RewardCategories": ["Luxury", "Travel", "Lifestyle"], "reward_rates": [{ "category": "default", "rate": 0.01 }], "PerksValue": 7000 },
            { "CardName": "Bank of America Customized Cash", "Issuer": "Bank of America", "CardTier": "Standard", "Currency": "USD", "Country": "US", "MinIncome": 20000, "MinCreditScore": 670, "AnnualFee": 0, "LoungeAccess": false, "ProfitMargin": 0.1, "RewardCategories": ["Cashback", "Choice Categories"], "reward_rates": [{ "category": "online_shopping", "rate": 0.03 }, { "category": "dining", "rate": 0.03 }, { "category": "travel", "rate": 0.03 }, { "category": "groceries", "rate": 0.02 }, { "category": "default", "rate": 0.01 }], "PerksValue": 0 },

            // ... and the rest of the 110+ cards
        ];
    }
};
